{% extends "_base.html" %}
{% block title %}Workstation AI{% endblock %}
{% block head_extra %}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/downloadjs@1.4.7"></script>
{% endblock %}
{% block content %}
<!-- START: workstation content -->
<main class="flex-grow overflow-y-auto p-4 md:p-8">
        <section id="anagrafica" class="section-content section-fade-in">
            <div class="bg-white p-6 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4">üìÑ Dati Anagrafici Cliente</h2>
                <div class="bg-[#F2F2F7] p-4 rounded-lg mb-6">
                    <h3 class="font-semibold text-[#1D1D1F] mb-2">Importa da PDF Ticket</h3>
                    <div id="ticket-dropzone" class="dropzone bg-gray-50 hover:bg-gray-100">
                        <input type="file" id="pdf-ticket-input" class="hidden" accept=".pdf" disabled>
                        <label for="pdf-ticket-input" class="cursor-pointer">
                            <span class="text-2xl">üìÅ</span>
                            <p class="mt-2 text-sm text-gray-600">Trascina qui il file PDF del ticket o fai clic per selezionarlo.</p>
                            <p id="ticket-dropzone-label" class="text-xs text-red-500 mt-1">Caricamento disabilitato. Backend non pronto.</p>
                        </label>
                    </div>
                    <button id="clear-ticket-btn" class="w-full mt-2 bg-[#FF3B30] text-white font-bold py-2 px-4 rounded-lg">üßπ Pulisci Dati Cliente</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input data-sync="numero_ticket" id="numero_ticket" type="text" placeholder="Numero Ticket" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                    <input data-sync="data_apertura" id="data_apertura" type="date" placeholder="Data Apertura" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                    <input data-sync="cliente" id="cliente" type="text" placeholder="Cliente" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none md:col-span-2">
                    <input data-sync="condominio" id="condominio" type="text" placeholder="Condominio" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none md:col-span-2">
                    <input data-sync="indirizzo" id="indirizzo" type="text" placeholder="Indirizzo" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none md:col-span-2">
                    <input data-sync="tipo_contratto" id="tipo_contratto" type="text" placeholder="Tipo Contratto" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                    <input data-sync="data_intervento_programmato" id="data_intervento_programmato" type="date" placeholder="Data Intervento Programmato" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                    <select data-sync="tecnico_anagrafica" id="tecnico_anagrafica" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                        <option value="">Seleziona Tecnico</option>
                        </select>
                    <input data-sync="urgenza" id="urgenza" type="text" placeholder="Livello Urgenza" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                </div>
                <textarea data-sync="note" id="note" placeholder="Note e Descrizione Guasto..." rows="4" class="w-full mt-4 bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none"></textarea>
                  <!-- GEMINI API BUTTON -->
                  <div class="mt-2 text-right">
                    <button id="diagnose-btn" class="bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">‚ú® Suggerisci Diagnosi (AI)</button>
                  </div>
            </div>
        </section>

        <section id="intervention" class="hidden section-content section-fade-in">
            <div class="bg-white p-6 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4">üîß Rapporto Tecnico di Intervento (RTI)</h2>

                <div class="bg-[#F2F2F7] p-4 rounded-lg mb-6">
                    <h3 class="font-semibold text-[#1D1D1F] mb-2">Numero RTI</h3>
                    <div class="flex space-x-2">
                        <input data-sync="numero_rti" id="numero_rti" type="text" placeholder="RTI-2025-001" class="flex-1 bg-white p-3 rounded-lg focus:ring-2 focus:ring-[#007AFF] outline-none">
                        <button id="generate-rti-btn" class="bg-[#007AFF] text-white font-bold py-3 px-4 rounded-lg">üîÑ Genera Nuovo RTI</button>
                    </div>
                    <p class="text-sm text-[#86868B] mt-2">Il numero RTI viene generato automaticamente in modo incrementale. Puoi modificarlo manualmente se necessario.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <input data-sync="data_intervento" id="data_intervento" type="date" placeholder="Data Intervento" class="bg-[#F2F2F7] p-3 rounded-lg">
                    <input data-sync="ora_intervento" id="ora_intervento" type="time" placeholder="Ora Intervento" class="bg-[#F2F2F7] p-3 rounded-lg">
                    <select data-sync="tecnico_intervento" id="tecnico_intervento" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                        <option value="">Seleziona Tecnico</option>
                        </select>
                    <input data-sync="numero_operai" id="numero_operai" type="number" placeholder="Numero Operai" value="1" class="bg-[#F2F2F7] p-3 rounded-lg">
                    </div>
                <textarea data-sync="intervento_effettuato" id="intervento_effettuato" placeholder="Inserisci parole chiave (es. 'pulito filtri, controllato gas') e lascia che l'AI generi la descrizione..." rows="5" class="w-full mt-4 bg-[#F2F2F7] p-3 rounded-lg"></textarea>
                <!-- GEMINI API BUTTON -->
                <div class="mt-2 text-right">
                    <button id="generate-desc-btn" class="bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">‚ú® Genera Descrizione (AI)</button>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm mt-6">
                    <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4">üí∞ RTIDF - Configurazione Costo</h2>
                    <div class="bg-[#F2F2F7] p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                            <div>
                                <label for="costo_totale_rtidf" class="text-sm font-medium text-[#86868B] block mb-2">Costo Totale RTIDF (‚Ç¨)</label>
                                <input id="costo_totale_rtidf" type="number" step="0.01" value="0.00" readonly
                                        class="w-full bg-gray-200 p-3 rounded-lg border focus:ring-2 focus:ring-[#007AFF] outline-none">
                                <p class="text-xs text-[#86868B] mt-1">Questo campo √® popolato automaticamente dal totale del MPLS.</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="mpls" class="hidden section-content section-fade-in">
            <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4 lg:mb-0">üí∞ Preventivo Lavori (MPLS)</h2>
                </div>

                <div class="bg-[#F2F2F7] p-4 rounded-lg mb-4">
                    <h3 class="font-semibold text-[#1D1D1F] mb-2">Numero MPLS/RTIDF</h3>
                    <input id="numero_mpls" type="text" placeholder="MPLS-2025-001" readonly class="w-full bg-white p-3 rounded-lg border-2 border-[#C6C6C8]">
                    <p class="text-sm text-[#86868B] mt-2">Il numero MPLS √® sincronizzato automaticamente con il numero RTI.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <input id="mpls_cliente" type="text" placeholder="Cliente" readonly class="bg-[#E5E5E5] p-3 rounded-lg border-transparent">
                    <input id="mpls_condominio" type="text" placeholder="Condominio" readonly class="bg-[#E5E5E5] p-3 rounded-lg border-transparent">
                    <input id="mpls_indirizzo" type="text" placeholder="Indirizzo" readonly class="bg-[#E5E5E5] p-3 rounded-lg border-transparent md:col-span-2">
                    <input id="mpls_data_intervento" type="date" placeholder="Data Intervento" readonly class="bg-[#E5E5E5] p-3 rounded-lg border-transparent">
                    <input id="mpls_tecnico" type="text" placeholder="Tecnico" readonly class="bg-[#E5E5E5] p-3 rounded-lg border-transparent">
                </div>

                <div class="bg-[#F2F2F7] p-4 rounded-lg">
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="is-guazzotti" class="h-5 w-5 rounded text-[#007AFF] focus:ring-[#007AFF]">
                            <span class="ml-2 text-[#1D1D1F]">Cliente Guazzotti (logica di calcolo speciale)</span>
                        </label>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="ore_manodopera" class="text-sm font-medium text-[#86868B]">Ore Manodopera</label>
                            <input id="ore_manodopera" type="number" value="0.0" class="w-full bg-white p-3 rounded-lg mt-1">
                        </div>
                        <div>
                            <label for="sovrapprezzo" class="text-sm font-medium text-[#86868B]">Sovrapprezzo Generico (‚Ç¨)</label>
                            <input id="sovrapprezzo" type="number" value="0.00" class="w-full bg-white p-3 rounded-lg mt-1">
                        </div>
                        <div>
                            <label for="iva-select" class="text-sm font-medium text-[#86868B]">Aliquota IVA</label>
                            <select id="iva-select" class="w-full bg-white p-3 rounded-lg mt-1">
                                <option value="22">22%</option>
                                <option value="10">10%</option>
                                <option value="0">0%</option>
                            </select>
                        </div>
                        <button id="recalculate-btn" class="self-end bg-[#007AFF] text-white font-bold py-3 px-4 rounded-lg">üîÑ Ricalcola Totali</button>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm">
                <h3 class="text-xl font-bold text-[#1D1D1F] mb-4">‚ûï Gestione Materiali</h3>

                <!-- NUOVA SEZIONE: PROMEMORIA LOGICA DI RICARICO -->
                <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg mb-4" role="alert">
                    <p class="font-bold">Promemoria Logica di Ricarico Materiali</p>
                    <ul class="list-disc list-inside text-sm mt-2">
                        <li><b>Cliente Standard:</b>
                            <ul class="list-disc list-inside pl-5">
                                <li><b>+40%</b> su materiali con costo d'acquisto &lt; 100‚Ç¨</li>
                                <li><b>+35%</b> su materiali con costo d'acquisto tra 100‚Ç¨ e 200‚Ç¨</li>
                                <li><b>+30%</b> su materiali con costo d'acquisto &gt; 200‚Ç¨</li>
                            </ul>
                        </li>
                        <li><b>Cliente Guazzotti:</b> Ricarico fisso del <b>+20%</b>.</li>
                    </ul>
                </div>
                <!-- FINE NUOVA SEZIONE -->

                <div class="bg-[#F2F2F7] p-4 rounded-lg mb-4">
                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-4">
                        <input id="nome_materiale_entry" type="text" placeholder="Nome Materiale" class="lg:col-span-2 bg-white p-3 rounded-lg">
                        <input id="qta_materiale_entry" type="number" placeholder="Quantit√†" class="bg-white p-3 rounded-lg">
                        <input id="prezzo_materiale_entry" type="number" placeholder="Prezzo (‚Ç¨)" class="bg-white p-3 rounded-lg">
                        <button id="add-material-btn" class="bg-[#34C759] text-white font-bold py-3 px-4 rounded-lg">‚ûï Aggiungi</button>
                    </div>
                    <div class="mt-4">
                        <div id="material-dropzone" class="dropzone bg-gray-50 hover:bg-gray-100">
                            <input type="file" id="pdf-material-input" class="hidden" accept=".pdf" disabled>
                            <label for="pdf-material-input" class="cursor-pointer">
                                <span class="text-2xl">üìÑ</span>
                                <p class="mt-2 text-sm text-gray-600">Trascina qui il PDF dei materiali o fai clic per selezionarlo.</p>
                                <p id="material-dropzone-label" class="text-xs text-red-500 mt-1">Caricamento disabilitato. Backend non pronto.</p>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left" id="materiali-table">
                        <thead>
                            <tr class="border-b-2 border-[#F2F2F7]">
                                <th class="p-3">Nome</th>
                                <th class="p-3 text-center">Qt√†</th>
                                <th class="p-3 text-right">Prezzo Acquisto</th>
                                <th class="p-3 text-right">Costo Totale</th>
                                <th class="p-3 text-center">Azione</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be added dynamically -->
                        </tbody>
                    </table>
                </div>

                <div class="mt-6 bg-[#F2F2F7] p-4 rounded-lg">
                    <h3 class="text-xl font-bold text-[#1D1D1F] mb-4">üìä Riepilogo Costi</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between"><span>Subtotale Materiali (vendita):</span><span id="summary-subtotale_materiali_vendita" class="font-semibold">‚Ç¨ 0,00</span></div>
                        <div class="flex justify-between"><span>Subtotale Manodopera:</span><span id="summary-subtotale_manodopera_vendita" class="font-semibold">‚Ç¨ 0,00</span></div>
                        <hr class="my-2 border-[#C6C6C8]">
                        <div class="flex justify-between text-sm text-[#86868B]"><span>Costo Gestione Pratica:</span><span id="summary-costo_gestione">‚Ç¨ 0,00</span></div>
                        <div class="flex justify-between text-sm text-[#86868B]"><span>Spese Interventi Brevi:</span><span id="summary-spese_brevi">‚Ç¨ 0,00</span></div>
                        <div class="flex justify-between text-sm text-[#86868B]"><span>Materiale di Consumo:</span><span id="summary-materiale_consumo">‚Ç¨ 0,00</span></div>
                        <div class="flex justify-between text-sm text-[#86868B]"><span>Sovrapprezzo Generico:</span><span id="summary-sovrapprezzo">‚Ç¨ 0,00</span></div>
                        <hr class="my-2 border-[#C6C6C8]">
                        <div class="flex justify-between font-semibold"><span>Imponibile:</span><span id="summary-totale_generale_vendita">‚Ç¨ 0,00</span></div>
                        <div class="flex justify-between font-semibold"><span>IVA (<span id="summary-iva_percentuale_label">22</span>%):</span><span id="summary-importo_iva">‚Ç¨ 0,00</span></div>
                        <hr class="my-2 border-[#C6C6C8]">
                        <div class="flex justify-between text-xl font-bold"><span>TOTALE FATTURA:</span><span id="summary-totale_ivato" class="text-[#007AFF]">‚Ç¨ 0,00</span></div>
                        <!-- NUOVA SEZIONE: VISUALIZZAZIONE MARGINE -->
                        <hr class="my-2 border-[#C6C6C8] border-dashed">
                        <div class="flex justify-between text-green-700">
                            <span class="font-semibold">Margine Totale (‚Ç¨):</span>
                            <span id="summary-margine_in_euro" class="font-bold">‚Ç¨ 0,00</span>
                        </div>
                        <div class="flex justify-between text-green-700">
                            <span class="font-semibold">Margine Totale (%):</span>
                            <span id="summary-margine_percentuale" class="font-bold">0,00%</span>
                        </div>
                        <!-- FINE NUOVA SEZIONE -->
                    </div>
                </div>
            </div>
        </section>

        <section id="finalize" class="hidden section-content section-fade-in">
            <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4">üí∞ RTIDF - Configurazione Costo</h2>
                <div class="bg-[#F2F2F7] p-4 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                        <div>
                            <label for="costo_totale_rtidf_finalize" class="text-sm font-medium text-[#86868B] block mb-2">Costo Totale RTIDF (‚Ç¨)</label>
                            <input id="costo_totale_rtidf_finalize" type="number" step="0.01" value="0.00" readonly
                                    class="w-full bg-gray-200 p-3 rounded-lg border focus:ring-2 focus:ring-[#007AFF] outline-none">
                            <p class="text-xs text-[#86868B] mt-1">Questo campo √® popolato automaticamente dal totale del MPLS.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4">üìé Gestione Allegati</h2>
                <div class="bg-[#F2F2F7] p-4 rounded-lg mb-4">
                    <div id="attachment-dropzone" class="dropzone bg-gray-50 hover:bg-gray-100">
                        <input type="file" id="attachment-input" class="hidden" accept="image/png, image/jpeg" multiple>
                        <label for="attachment-input" class="cursor-pointer">
                            <span class="text-2xl">üì∑</span>
                            <p class="mt-2 text-sm text-gray-600">Trascina qui le immagini (JPG, PNG) o fai clic per selezionarle.</p>
                        </label>
                    </div>
                    <button id="clear-attachments-btn" class="w-full mt-2 bg-[#FF3B30] text-white font-bold py-2 px-4 rounded-lg">üóëÔ∏è Rimuovi Tutti</button>
                </div>

                <div id="attachments-list" class="space-y-2">
                    <!-- Attachments will be listed here -->
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4">‚úÖ Esportazione Documenti</h2>
                <p class="text-[#86868B] mb-6">Genera i documenti finali per il cliente o per l'archiviazione interna.</p>

                <div class="bg-[#F2F2F7] p-4 rounded-lg mb-6">
                    <h3 class="font-semibold text-[#1D1D1F] mb-3">Opzioni di Esportazione</h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="include-attachments" class="h-4 w-4 rounded text-[#007AFF] focus:ring-[#007AFF]">
                            <span class="ml-2 text-sm">Includi allegati nei documenti</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="include-signature" class="h-4 w-4 rounded text-[#007AFF] focus:ring-[#007AFF]">
                            <span class="ml-2 text-sm">Includi spazio per firma cliente</span>
                        </label>
                    </div>
                    <div class="mt-4">
                        <label for="pdf-template-select" class="block text-sm font-medium text-[#1D1D1F] mb-2">Seleziona Template PDF:</label>
                        <select id="pdf-template-select" class="w-full bg-white p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                            <option value="standard">Template Standard</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    <button data-pdf-type="RTI" class="generate-pdf-btn bg-[#007AFF] text-white font-bold py-4 px-4 rounded-lg">
                        üìã <br>Genera RTI
                    </button>
                    <button data-pdf-type="RTIDF" class="generate-pdf-btn bg-[#5856D6] text-white font-bold py-4 px-4 rounded-lg">
                        üí∞ <br>Genera RTIDF
                    </button>
                    <button data-pdf-type="PREVENTIVO" class="generate-pdf-btn bg-[#FF2D55] text-white font-bold py-4 px-4 rounded-lg">
                        ‚úâÔ∏è <br>Preventivo Cliente (PL)
                    </button>
                    <button data-pdf-type="MPLS" class="generate-pdf-btn bg-[#FF9500] text-white font-bold py-4 px-4 rounded-lg">
                        üìä <br>Genera MPLS
                    </button>
                    <button data-pdf-type="COMPLETO" class="generate-pdf-btn bg-[#34C759] text-white font-bold py-4 px-4 rounded-lg">
                        üìÑ <br>Report Completo
                    </button>
                </div>

                <div class="mt-4 text-sm text-[#86868B]">
                    <p><strong>RTI:</strong> Rapporto Tecnico di Intervento</p>
                    <p><strong>RTIDF:</strong> RTI con indicazione del costo totale</p>
                    <p><strong>Preventivo (PL):</strong> Offerta per il cliente (senza costi interni)</p>
                    <p><strong>MPLS:</strong> Preventivo dettagliato con materiali e margini</p>
                    <p><strong>Completo:</strong> Documento unico con tutti i dati</p>
                </div>

                <div class="bg-[#FFF5E6] p-4 rounded-lg mt-6 border border-[#FF9500]">
                    <h3 class="font-semibold text-[#D97706] mb-3">üõ†Ô∏è Debug: Esporta in formato HTML</h3>
                    <p class="text-sm text-[#B45309] mb-4">Usa questi pulsanti per scaricare una versione HTML del report. √à utile per controllare la formattazione e i dati prima di creare il PDF finale.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                        <button data-html-type="RTI" class="generate-html-btn bg-[#FF9500] text-white font-bold py-4 px-4 rounded-lg">
                            üìã <br>RTI (HTML)
                        </button>
                        <button data-html-type="RTIDF" class="generate-html-btn bg-[#FF9500] text-white font-bold py-4 px-4 rounded-lg">
                            üí∞ <br>RTIDF (HTML)
                        </button>
                        <button data-html-type="PREVENTIVO" class="generate-html-btn bg-[#FF9500] text-white font-bold py-4 px-4 rounded-lg">
                            ‚úâÔ∏è <br>Preventivo (HTML)
                        </button>
                        <button data-html-type="MPLS" class="generate-html-btn bg-[#FF9500] text-white font-bold py-4 px-4 rounded-lg">
                            üìä <br>MPLS (HTML)
                        </button>
                        <button data-html-type="COMPLETO" class="generate-html-btn bg-[#FF9500] text-white font-bold py-4 px-4 rounded-lg">
                            üìÑ <br>Completo (HTML)
                        </button>
                    </div>
                </div>

                <div class="bg-green-100 p-4 rounded-lg mt-6 border border-green-500">
                    <h3 class="font-semibold text-green-800 mb-3">üìß Invia Chiusura Ticket</h3>
                    <p class="text-sm text-green-700 mb-4">Questo pulsante scaricher√† il report RTI in formato HTML e preparer√† una bozza di email nel tuo programma di posta predefinito. <strong>Dovrai allegare manually il file scaricato.</strong></p>
                    <button id="email-ticket-btn" class="w-full bg-green-600 text-white font-bold py-4 px-4 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        Invia Chiusura Ticket a Guazzotti
                    </button>
                </div>

            </div>
        </section>

        <!-- NUOVA SEZIONE ARCHIVIO -->
        <section id="archivio" class="hidden section-content section-fade-in">
            <div class="bg-white p-6 rounded-xl shadow-sm">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-2xl font-bold text-[#1D1D1F] mb-4 md:mb-0">üóÑÔ∏è Archivio Documenti</h2>
                    <div class="flex items-center space-x-2 w-full md:w-auto">
                        <!-- MODIFIED: Placeholder updated -->
                        <input type="text" id="archivio-search" placeholder="Cerca per cliente, condominio, n¬∞ RTI..." class="flex-grow bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none w-full md:w-64">
                        <select id="archivio-filter-type" class="bg-[#F2F2F7] p-3 rounded-lg border-transparent focus:ring-2 focus:ring-[#007AFF] outline-none">
                            <option value="all">Tutti i Tipi</option>
                            <option value="RTI">RTI</option>
                            <option value="RTIDF">RTIDF</option>
                            <option value="PREVENTIVO">Preventivo</option>
                            <option value="MPLS">MPLS</option>
                            <option value="COMPLETO">Completo</option>
                        </select>
                        <button id="clear-archive-btn" class="bg-[#FF3B30] text-white font-bold py-3 px-4 rounded-lg whitespace-nowrap">Svuota Archivio</button>
                    </div>
                </div>
                <div id="archivio-list" class="space-y-3">
                    <!-- I documenti archiviati verranno mostrati qui -->
                    <p class="text-center text-gray-500 py-8">L'archivio √® vuoto.</p>
                </div>
            </div>
        </section>

    </main>
<!-- END: workstation content -->
{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', filename='js/workstation.js') }}"></script>
{% endblock %}