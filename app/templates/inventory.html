<!-- Sostituisci app/templates/inventory.html con questo: -->
{% extends "_base.html" %}
{% block title %}Inventario{% endblock %}
{% block content %}
<div class="bg-white p-4 rounded-xl shadow">
  <h1 class="text-xl font-semibold mb-4">Inventario</h1>
  
  <!-- üî• FILTRI -->
  <div class="mb-4 p-4 bg-gray-50 rounded-lg">
    <form method="get" class="grid md:grid-cols-5 gap-3">
      <!-- Ricerca testo -->
      <div>
        <label class="block text-xs text-gray-600 mb-1">Cerca</label>
        <input type="text" name="search" value="{{ current_filters.search or '' }}" 
               placeholder="Codice o descrizione" 
               class="w-full border rounded px-2 py-1 text-sm">
      </div>
      
      <!-- Filtro magazzino -->
      <div>
        <label class="block text-xs text-gray-600 mb-1">Magazzino</label>
        <select name="magazzino_id" class="w-full border rounded px-2 py-1 text-sm">
          <option value="">Tutti i magazzini</option>
          {% for mag in magazzini %}
            <option value="{{ mag.id }}" 
                    {% if current_filters.magazzino_id == mag.id %}selected{% endif %}>
              {{ mag.codice }} - {{ mag.nome }}
            </option>
          {% endfor %}
        </select>
      </div>
      
      <!-- Checkbox solo disponibili -->
      <div class="flex items-center">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="only_in_stock" value="1" 
                 {% if current_filters.only_in_stock %}checked{% endif %}
                 class="mr-2">
          Solo con giacenza
        </label>
      </div>
      
      <!-- Checkbox sotto scorta -->
      <div class="flex items-center">
        <label class="flex items-center text-sm">
          <input type="checkbox" name="under_min" value="1" 
                 {% if current_filters.under_min %}checked{% endif %}
                 class="mr-2">
          Sotto scorta minima
        </label>
      </div>
      
      <!-- Pulsanti -->
      <div class="flex gap-2">
        <button type="submit" class="px-3 py-1 bg-indigo-600 text-white rounded text-sm">
          üîç Filtra
        </button>
        <a href="{{ url_for('inventory.inventory') }}" 
           class="px-3 py-1 bg-gray-300 text-gray-700 rounded text-sm">
          üîÑ Reset
        </a>
      </div>
    </form>
  </div>
  
  <!-- TABELLA RISULTATI -->
  <div class="overflow-x-auto">
    <table class="w-full text-sm border">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-left">Codice</th>
          <th class="p-2 text-left">Descrizione</th>
          <th class="p-2 text-left">Magazzino</th>
          <th class="p-2 text-right">Giacenza</th>
          <th class="p-2 text-right">Scorta min</th>
          <th class="p-2 text-right">Ult. costo</th>
          <th class="p-2 text-center">Stato</th>
        </tr>
      </thead>
      <tbody>
        {% for a in articoli %}
        <tr class="border-t hover:bg-gray-50">
          <td class="p-2 font-mono text-xs">{{ a.codice_interno }}</td>
          <td class="p-2">{{ a.descrizione }}</td>
          <td class="p-2">
            {% if a.magazzino_codice %}
              <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                {{ a.magazzino_codice }}
              </span>
            {% else %}
              <span class="text-gray-400">‚Äî</span>
            {% endif %}
          </td>
          <td class="p-2 text-right">
            {% if a.giacenza > 0 %}
              <span class="text-green-700 font-semibold">{{ a.giacenza }}</span>
            {% elif a.giacenza == 0 %}
              <span class="text-gray-500">0</span>
            {% else %}
              <span class="text-red-600">{{ a.giacenza }}</span>
            {% endif %}
          </td>
          <td class="p-2 text-right">{{ a.qta_scorta_minima or 0 }}</td>
          <td class="p-2 text-right">‚Ç¨ {{ "%.2f"|format(a.last_cost or 0) }}</td>
          <td class="p-2 text-center">
            {% if a.qta_scorta_minima > 0 and a.giacenza < a.qta_scorta_minima %}
              <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">
                ‚ö†Ô∏è Sotto scorta
              </span>
            {% elif a.giacenza > 0 %}
              <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                ‚úÖ Disponibile
              </span>
            {% else %}
              <span class="text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded">
                ‚ùå Esaurito
              </span>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td class="p-4 text-center text-gray-500" colspan="7">
            Nessun articolo trovato con i filtri selezionati.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  <!-- Statistiche -->
  <div class="mt-4 text-sm text-gray-600">
    üìä Totale articoli mostrati: <strong>{{ articoli|length }}</strong>
  </div>
</div>
{% endblock %}
