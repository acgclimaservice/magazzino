{% extends "_base.html" %}
{% block title %}Movimenti{% endblock %}
{% block content %}
<div class="bg-white p-4 rounded-xl shadow space-y-4">
  <h1 class="text-xl font-semibold">Movimenti</h1>

  <form method="post" action="{{ url_for('movements.movements') }}" class="grid md:grid-cols-6 gap-3">
    <div class="md:col-span-2">
      <label class="text-xs text-gray-500">Codice articolo</label>
      <input name="codice_articolo" class="border rounded w-full p-2" required>
    </div>
    <div>
      <label class="text-xs text-gray-500">Tipo</label>
      <select name="tipo" class="border rounded w-full p-2">
        <option value="carico">Carico</option>
        <option value="scarico">Scarico</option>
        <option value="trasferimento">Trasferimento</option>
      </select>
    </div>
    <div>
      <label class="text-xs text-gray-500">Quantità</label>
      <input name="quantita" type="number" step="0.001" class="border rounded w-full p-2" required>
    </div>
    <div class="md:col-span-2">
      <label class="text-xs text-gray-500">Magazzino</label>
      <select name="magazzino" class="border rounded w-full p-2">
        {% for m in magazzini %}<option value="{{ m.id }}">{{ m.codice }} — {{ m.nome }}</option>{% endfor %}
      </select>
    </div>
    <div class="md:col-span-6">
      <button class="px-3 py-2 rounded bg-indigo-600 text-white">Registra</button>
    </div>
  </form>

  <div class="overflow-x-auto">
    <table class="w-full text-sm border">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2">Quando</th>
          <th class="p-2">Articolo</th>
          <th class="p-2">Tipo</th>
          <th class="p-2 text-right">Qta</th>
          <th class="p-2">Da</th>
          <th class="p-2">A</th>
        </tr>
      </thead>
      <tbody>
        {% for m in movimenti.items %}
        <tr class="border-t">
          <td class="p-2">{{ m.data }}</td>
          <td class="p-2">{{ m.articolo.codice_interno }}</td>
          <td class="p-2">{{ m.tipo }}</td>
          <td class="p-2 text-right">{{ m.quantita }}</td>
          <td class="p-2">{{ (labels_da.get(m.id) if labels_da else None) or (m.magazzino_partenza.codice if m.magazzino_partenza else '') }}</td>
          <td class="p-2">{{ m.magazzino_arrivo.codice if m.magazzino_arrivo else '' }}</td>
        </tr>
        {% else %}
        <tr><td class="p-2 text-gray-500" colspan="6">Nessun movimento.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if movimenti.pages > 1 %}
  <div class="mt-3 flex gap-2">
    {% if movimenti.has_prev %}
      <a class="px-2 py-1 border rounded" href="{{ url_for('movements.movements', page=movimenti.prev_num) }}">« Prev</a>
    {% endif %}
    <span class="px-2 py-1">Pagina {{ movimenti.page }} / {{ movimenti.pages }}</span>
    {% if movimenti.has_next %}
      <a class="px-2 py-1 border rounded" href="{{ url_for('movements.movements', page=movimenti.next_num) }}">Next »</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
